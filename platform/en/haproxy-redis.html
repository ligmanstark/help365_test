<!DOCTYPE html>
<html lang="en">

<head>
    <title>Configure HAProxy for Redis Sentinel</title>
    <meta name="generator" content="Help+Manual" />
    <meta name="keywords" content="" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The architecture of a high-availability BRIX cluster involves interaction between the BRIX application microservices and Redis Sentinel. To ensure reliable load balancing..." />
    <meta name="picture" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Full documentation for BRIX365 platform. Low-code developer guide. User guide. Admin guide. Developer guide." />
    <meta property="og:url" content="https://brix365.com/en/help" />
    <meta property="og:image" content="" />                                                              
    <link rel="icon" href="favicon.png" type="image/png" />
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./jquery-ui.css" />
    <link rel="stylesheet" href="default.css" />
    <link rel="stylesheet" href="./search-yandex.css" />
    <link rel="stylesheet" href="./article.css" />
    <link rel="stylesheet" href="./glossary.css" />
    <link rel="stylesheet" href="./theme.css" />
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>

<body>
    
    <script>!function(e,t,c,n,r,a,m){e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date;for(var s=0;s<document.scripts.length;s++)if(document.scripts[s].src===n)return;a=t.createElement(c),m=t.getElementsByTagName(c)[0],a.async=1,a.src=n,m.parentNode.insertBefore(a,m)}(window,document,"script","https://mc.yandex.ru/metrika/tag.js"),ym(83179930,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img alt=""src=https://mc.yandex.ru/watch/83179930 style=position:absolute;left:-9999px></div></noscript> 
    
    ﻿<header class="header elma-365">
  <div class="container">
    <a class="header__logo" href="https://brix365.com/en/help">
      <img src="./logo-en.svg">
    </a>
 <!-- <div class="hero__search-form" id="search-panel">
   <form class="search-form" onsubmit="ym(83180416,'reachGoal','poisk')">
     <label class="search-form__label">
       <span id="reset-search" class="search__icon"></span>
       <input class="search-form__input" type="text">
     </label>
     <input class="search-form__submit" type="submit" value="Submit">
   </form>
  </div>       -->
  
     <div class="hero__search-form" id="search-panel"> <form class="search-form"> <label class="search-form__label"> <span id="reset-search" class="search__icon"></span> <input class="search-form__input" type="text"> </label> <input class="search-form__submit" type="submit" value="Submit"> </form> </div> 
  <div class="hero__search">
      <a href="#" id="search-icon" class="hero__search-icon">
        <img src="search-icon-white.svg" alt="search string">
      </a>
      <a href="#" id="side-menu-icon" class="hero__side-icon">
        <img src="side_menu.svg" alt="side menu">
      </a>
    </div>  
  <div class="header__navi">
        
        <ul class="header__list"><li><span class="solution-select"><span class="solution-select__selected"></span><svg width="7" height="4" viewBox="0 0 7 4" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L3.5 3.5L6 1" stroke="white" stroke-linecap="round" stroke-linejoin="round"/></svg><ul class="solution-select__list"><li><a class="project-link" href="https://brix365.com/en/help/platform/get-trial.html">Platform</a></li><li><a class="project-link" href="https://brix365.com/en/help/ecm/ecm-functions.html">ECM</a></li><li><a class="project-link" href="https://brix365.com/en/help/crm/crm_overview.html">CRM</a></li><li><a class="project-link" href="https://brix365.com/en/help/service/service-functions.html">Service</a></li><li><a class="project-link" href="https://brix365.com/en/help/projects/projects-functions.html">Projects</a></li><li><a class="project-link" href="https://brix365.com/en/help/business_solutions/-elma365-store.html">Business Solutions</a></li></ul></span></li><li><a href="https://api.brix365.com/en/" target="_blank">API</a></li><li><a href="https://tssdk.brix365.com/" target="_blank">SDK</a></li></ul>
        
        
   </div>
  </div>

</header>



    
    <main class="main container">

        <aside class="sidebar" id="sidebar">
        <div class="sidebar__header">
                 <a class="header__logo" href="https://brix365.com/en/help">
                    <img src="./logo-light-en.svg">
                 </a>
                    <span class="sidebar__close elma-365-close" id="close"></span>
            </div>
            <div class="sidebar__wrapper" id="side-menu">
                
            </div>
        </aside>

        <article class="article" id="article">
            <div class="article-inner">           
                <div class="content">
                    <header class="article__header">
                        
                            <div class="topic__breadcrumbs">
                                <p><a href="elma365-on-premises.html">BRIX On-Premises</a> &gt; <a href="infrastructure-preparation.html">Prepare infrastructure</a> &gt; Load balancer / Configure HAProxy for Redis Sentinel</p>
                            </div>
                        
                        <div class="topic__title"><h1 class="p_Heading1"><span class="f_Heading1">Configure HAProxy for Redis Sentinel</span></h1>
</div>
                    
</header>
                    <section class="article__content">
                        <div class="scroll-top-inner">
                            <a href="#h1-article" class="scroll-top"></a>
                        </div>
                        <!-- Placeholder for topic body. -->
                        <p style="line-height: 1.28; margin: 0 0 11px 0;">The architecture of a high-availability BRIX cluster involves interaction between the BRIX application microservices and Redis Sentinel. To ensure reliable load balancing within the system, configure HAProxy for Redis Sentinel. This setup allows traffic to be redirected to the primary Redis server in case of a technical failure, ensuring continuous system operation</p>
<h2 class="p_Heading2"><span class="f_Heading2">Example HAProxy configuration for Redis Sentinel</span></h2>
<p style="line-height: 1.20; margin: 11px 0 15px 0;"><span style="color: #394149;">ВThis article provides a configuration for identifying the primary Redis server and redirecting traffic to it. HAProxy will automatically check the </span><code><b>6379</b></code><span style="color: #394149;"> port on Redis servers and determine the current server with the </span><code><b>master</b></code><span style="color: #394149;"> role.</span></p>
<p style="line-height: 1.20; margin: 11px 0 15px 0;"><span style="color: #394149;">Steps to create HAProxy configuration for Redis Sentinel:</span></p>
<ol style="list-style-type:upper-roman">
<li value="1" style="line-height: 1.28; margin-top: 0; margin-right: 0; margin-bottom: 11px;"><span style="color: #394149;">Open the </span><code><b>haproxy.cfg</b></code><span style="font-size: 13px;"> </span><span style="color: #394149;">configuration file for editing using the command:</span></li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid; margin: 0 0 0 34px;"><span class="f_CodeExample">sudo&nbsp;nano&nbsp;/etc/haproxy/haproxy.cfg</span></p>
<ol style="list-style-type:upper-roman" start="2">
<li value="2" style="line-height: 1.20; margin-top: 11px; margin-right: 0; margin-bottom: 15px;"><span style="color: #394149;">Make changes to the </span><code><b>haproxy.cfg</b></code><span style="font-size: 13px;"> </span><span style="color: #394149;">configuration file:</span></li></ol>
<p class="p_Normal" style="margin: 0 0 0 33px;"><a class="dropdown-toggle" style="font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;" href="javascript:HMToggle('toggle','TOGGLE0186A1')">Configuration example</a></p>
<div id="TOGGLE0186A1" class="dropdown-toggle-body" style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; padding: 0 0 0 0; margin: 0 0 0 0;"><table style="border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:0; border:none"><p class="p_CodeExample" style="white-space: normal; page-break-inside: auto;"><span class="f_CodeExample">### Redis ###</span><br />
<span class="f_CodeExample">frontend</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">redis_master</span><br />
<span class="f_CodeExample"> &nbsp; bind</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">haproxy-server.your_domain:6379</span><br />
<span class="f_CodeExample"> &nbsp; mode</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">tcp</span><br />
<span class="f_CodeExample"> &nbsp; option</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">tcplog</span><br />
<span class="f_CodeExample"> &nbsp; option</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">clitcpka</span><br />
<span class="f_CodeExample"> &nbsp; timeout</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">client</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">24h</span><br />
<span class="f_CodeExample"> &nbsp; default_backend</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">redis_master</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample">backend</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">redis_master</span><br />
<span class="f_CodeExample"> &nbsp; balance</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">first</span><br />
<span class="f_CodeExample"> &nbsp; mode</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">tcp</span><br />
<span class="f_CodeExample"> &nbsp; timeout</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">queue</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">2s</span><br />
<span class="f_CodeExample"> &nbsp; timeout</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">connect</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">2s</span><br />
<span class="f_CodeExample"> &nbsp; timeout</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">1s</span><br />
<span class="f_CodeExample"> &nbsp; option</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">srvtcpka</span><br />
<span class="f_CodeExample"> &nbsp; timeout</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">server</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">24h</span><br />
<span class="f_CodeExample"> &nbsp; option</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">tcp-check</span><br />
<span class="f_CodeExample"> &nbsp; tcp-check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">connect</span><br />
<span class="f_CodeExample"> &nbsp; tcp-check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">send</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">AUTH\</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;PASSWORD&gt;\r\n</span><br />
<span class="f_CodeExample"> &nbsp; tcp-check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">send</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">PING\r\n</span><br />
<span class="f_CodeExample"> &nbsp; tcp-check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">expect</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">string</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">+PONG</span><br />
<span class="f_CodeExample"> &nbsp; tcp-check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">send</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">info\</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">replication\r\n</span><br />
<span class="f_CodeExample"> &nbsp; tcp-check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">expect</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">string</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">role:master</span><br />
<span class="f_CodeExample"> &nbsp; tcp-check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">send</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">QUIT\r\n</span><br />
<span class="f_CodeExample"> &nbsp; tcp-check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">expect</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">string</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">+OK</span><br />
<span class="f_CodeExample"> &nbsp; server</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">redis-server1</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">redis-server1.your_domain:6379</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">inter</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">5s</span><br />
<span class="f_CodeExample"> &nbsp; server</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">redis-server2</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">redis-server2.your_domain:6379</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">inter</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">5s</span><br />
<span class="f_CodeExample"> &nbsp; server</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">redis-server3</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">redis-server3.your_domain:6379</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">check</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">inter</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">5s</span><br />
<span class="f_CodeExample">### Redis ###</span></p>
</td>
</tr>
</table>
</div>
<ol style="list-style-type:upper-roman" start="3">
<li value="3" style="line-height: 1.20; margin-top: 11px; margin-right: 0; margin-bottom: 15px;"><span style="font-size: 13px; color: #394149;">Restart HAProxy to apply changes:</span></li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid; margin: 0 0 0 34px;"><span class="f_CodeExample">sudo&nbsp;systemctl&nbsp;restart&nbsp;haproxy</span></p>
<p style="line-height: 1.28; margin: 0 0 11px 0;"><span style="font-size: 17px; font-family: Calibri,Vectora,'Droid Sans','Open Sans',Frutiger,sans-serif;">After completing the HAProxy configuration, traffic will be directed to the primary Redis server (master). In case of failures, this setup ensures the stable operation of the system.</span></p>

                        <div class="bottom-nav">
                            
                                <a id="prev-link" class="topic__navi_prev" href="haproxy-rabbitmq.html">
                                    <span class="bottom-nav__arrow bottom-nav__arrow--prev"></span> <span
                                        class="bottom-nav__link">haproxy-rabbitmq.html</span>
                                </a>
                            
                            
                                <a id="next-link" class="topic__navi_next" href="haproxy-s3-minio.html">
                                    <span class="bottom-nav__link">haproxy-s3-minio.html</span> <span
                                        class="bottom-nav__arrow bottom-nav__arrow--next"></span>
                                </a>
                            
                        </div>
                        <!-- добавляет на страницу строку блок Была ли статья полезной?  -->
                          <div class="feedback" id="feedback"><span><b>Was this helpful?</b></span><form action="" method="POST" class="feedback-form" id="feedback-form"><div class="feedback__popup feedback__popup-response" id="feedback__popup_thx" style="display: none;">Thanks for your feedback!</div><div class="feedback__popup" id="feedback__popup_why" style="display: none;"><div class="feedback__popup-header">Please specify why:</div><input type="radio" name="category" id="bad_recommendation" value="bad_recommendation"><label for="bad_recommendation">Recommendations did not help me</label><input type="radio" name="category" id="difficult_text" value="difficult_text"><label for="difficult_text">Article is hard to understand</label><input type="radio" name="category" id="no_answer" value="no_answer"><label for="no_answer">Didn’t answer my question</label><input type="radio" name="category" id="bad_header" value="bad_header"><label for="bad_header">Content does not match the topic</label><input type="radio" name="category" id="other_reason" value="other_reason"><label for="other_reason">Other</label></div><div class="feedback__popup" id="feedback__popup-other" style="display: none;"><div class="feedback__popup-header">How can we improve the article?</div><textarea class="feedback__textarea" name="other" id=""></textarea><input type="submit" class="feedback__other-btn" value="Submit"></div><div class="feedback-form__btn-group"><input type="radio" name="useful" id="feedback__useful_yes" value="true"><label for="feedback__useful_yes"><img src="like.svg" class="small-img"><spanclass="feedback-form__btn-group_yes-btn">Yes</spanclass="feedback-form__btn-group_yes-btn"></label><input type="radio" name="useful" id="feedback__useful_no" value="false"><label for="feedback__useful_no"><img src="dislike.svg" class="small-img"><spanclass="feedback-form__btn-group_no-btn">No</spanclass="feedback-form__btn-group_no-btn"></label></div><select name="category"><option disabled="">Please specify why</option><option value="bad_recommendation" selected="">Recommendations did not help me</option><option value="difficult_text">Article is hard to understand</option><option value="no_answer">Didn’t answer my question</option><option value="bad_header">Content does not match the topic</option><option value="other_reason">Other</option></select><input type="submit"></form></div>
                           
                    </section>
                </div>
                <aside class="article__sidebar" style="display:none">
                    <input type="checkbox" />
                    <div class="article__arrow"></div>
                    <div class="table-of-contents elma365-right" id="toc2Content">
                        <h3 class="h3-toc">In this topic</h3>
                        <nav id="toc2"></nav>
                    </div>
                </aside>
            </div>
        </article>
    </main>               
    <footer class="footer">
        <div class="footer-container">
  <div class="footer-mobile">
    
    <ul class="footer-mobile__list"><li><a href="https://brix365.com/en/" target="_blank">BRIX</a></li><li><a href="https://tssdk.brix365.com/en/latest/" target="_blank">SDK</a></li><li><a href="https://api.brix365.com/en/" target="_blank">API</a></li></ul><ul class="footer-mobile__list"><li><a href="https://brix365.com/en/help/platform/get-trial.html">Platform</a></li><li><a href="https://brix365.com/en/help/ecm/ecm-functions.html">ECM</a></li><li><a href="https://brix365.com/en/help/service/service-functions.html">Service</a></li><li><a href="https://brix365.com/en/help/projects/projects-functions.html">Projects</a></li></ul>
    
    
  </div>
  <div class="footer-wrap">
    
      <div><span class="mobile-question-popup">Send feedback</span><form method="POST" action class="question__popup question-xs" id="question__popup"><div class="question-wrap"><span class="close"></span><span class="title">Ask a question</span><label for="help_question" style="display: none;"></label><textarea name="help_question" id="help_question"></textarea><input type="submit" value="Send"></div></form><div class="hidden fade-in question-success-xs">Sent</div></div>
    
    <div class="footer-flex-b">
      <span class="footer-copy">&copy; 2025 BRIX</span>
      <ul class="footer-list">
        
        <li class="footer-item">
            <a href="#" class="arrow-top" style="display: block;"></a>
        </li>
        
      </ul>
    </div>
  </div>
</div>
 
    </footer>
    <iframe name="hmnavigation" style="display:none!important"></iframe>
    <script src="./jquery-ui.js"></script>
    <!--script src="//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script-->
    <script src="./jquery.tocify.min.js"></script>
    <script src="./TypoReporter.min.js"></script>
    <script src="./google-search.js"></script>
    <script src="./main.js"></script>
<script type="text/javascript">
HMInitToggle('TOGGLE0186A1','hm.type','dropdown','hm.state','0');
</script>
</body>

</html>
