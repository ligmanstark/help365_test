<!DOCTYPE html>
<html lang="en">

<head>
    <title>Prepare Linux OS for operation in a high-load cluster</title>
    <meta name="generator" content="Help+Manual" />
    <meta name="keywords" content="" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="To ensure maximum performance and stability of the Kubernetes system, optimize the operating system on which it is running. In this article, we will explore the installation of..." />
    <meta name="picture" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Full documentation for BRIX365 platform. Low-code developer guide. User guide. Admin guide. Developer guide." />
    <meta property="og:url" content="https://brix365.com/en/help" />
    <meta property="og:image" content="" />                                                              
    <link rel="icon" href="favicon.png" type="image/png" />
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./jquery-ui.min.css" />
    <link rel="stylesheet" href="default.css" />
    <link rel="stylesheet" href="./search-yandex.css" />
    <link rel="stylesheet" href="./article.css" />
    <link rel="stylesheet" href="./glossary.css" />
    <link rel="stylesheet" href="./theme.css" />
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>

<body>
    
    <script>!function(e,t,c,n,r,a,m){e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date;for(var s=0;s<document.scripts.length;s++)if(document.scripts[s].src===n)return;a=t.createElement(c),m=t.getElementsByTagName(c)[0],a.async=1,a.src=n,m.parentNode.insertBefore(a,m)}(window,document,"script","https://mc.yandex.ru/metrika/tag.js"),ym(83179930,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img alt=""src=https://mc.yandex.ru/watch/83179930 style=position:absolute;left:-9999px></div></noscript> 
    
    ﻿<header class="header elma-365">
  <div class="container">
    <a class="header__logo" href="https://brix365.com/en/help">
      <img src="./logo-en.svg" alt="header logo">
    </a>
 <!-- <div class="hero__search-form" id="search-panel">
   <form class="search-form" onsubmit="ym(83180416,'reachGoal','poisk')">
     <label class="search-form__label">
       <span id="reset-search" class="search__icon"></span>
       <input class="search-form__input" type="text">
     </label>
     <input class="search-form__submit" type="submit" value="Submit">
   </form>
  </div>       -->
  
     <div class="hero__search-form" id="search-panel"> <form class="search-form"> <label class="search-form__label"> <span id="reset-search" class="search__icon"></span> <input class="search-form__input" type="text"> </label> <input class="search-form__submit" type="submit" value="Submit"> </form> </div> 
  <div class="hero__search">
      <a href="#" id="search-icon" class="hero__search-icon">
        <img src="search-icon-white.svg" alt="search string">
      </a>
      <a href="#" id="side-menu-icon" class="hero__side-icon">
        <img src="side_menu.svg" alt="side menu">
      </a>
    </div>  
  <div class="header__navi">
        
        <ul class="header__list"><li><span class="solution-select"><span class="solution-select__selected"></span><svg width="7" height="4" viewBox="0 0 7 4" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L3.5 3.5L6 1" stroke="white" stroke-linecap="round" stroke-linejoin="round"/></svg><ul class="solution-select__list"><li><a class="project-link" href="https://brix365.com/en/help/platform/get-trial.html">Platform</a></li><li><a class="project-link" href="https://brix365.com/en/help/ecm/ecm-functions.html">ECM</a></li><li><a class="project-link" href="https://brix365.com/en/help/crm/crm_overview.html">CRM</a></li><li><a class="project-link" href="https://brix365.com/en/help/service/service-functions.html">Service</a></li><li><a class="project-link" href="https://brix365.com/en/help/projects/projects-functions.html">Projects</a></li><li><a class="project-link" href="https://brix365.com/en/help/business_solutions/-elma365-store.html">Business Solutions</a></li></ul></span></li><li><a href="https://api.brix365.com/en/" target="_blank">API</a></li><li><a href="https://tssdk.brix365.com/" target="_blank">SDK</a></li></ul>
        
        
   </div>
  </div>

</header>



    
    <main class="main container">

        <aside class="sidebar" id="sidebar">
        <div class="sidebar__header">
                 <a class="header__logo" href="https://brix365.com/en/help">
                    <img src="./logo-light-en.svg">
                 </a>
                    <span class="sidebar__close elma-365-close" id="close"></span>
            </div>
            <div class="sidebar__wrapper" id="side-menu">
                
            </div>
        </aside>

        <article class="article" id="article">
            <div class="article-inner">           
                <div class="content">
                    <header class="article__header">
                                        <div class="article__bread" style="display:flex; gap:10px;">
                        <span id="subcategory" class="search-res__item-category search-res__item-category_subcategory subcategory article__badge"></span>
                        
                            <div class="topic__breadcrumbs">     
                                <p><a href="elma365-on-premises.html">BRIX On-Premises</a> &gt; <a href="infrastructure-preparation.html">Prepare infrastructure</a> / Prepare Linux OS for operation in a high-load cluster</p>
                            </div>
                        
                    </div>
                        <div class="topic__title"><h1 class="p_Heading1"><span class="f_Heading1">Prepare Linux OS for operation in a high-load cluster</span></h1>
</div>
                    
</header>
                    <section class="article__content">
                        <div class="scroll-top-inner">
                            <a href="#h1-article" class="scroll-top"></a>
                        </div>
                        <!-- Placeholder for topic body. -->
                        <p class="p_Normal">To ensure maximum performance and stability of the Kubernetes system, optimize the operating system on which it is running. In this article, we will explore the installation of an optimized kernel using Ubuntu 20.04 as an example.</p>
<p class="p_Normal">The optimized Ubuntu kernel is a specially adapted Linux kernel. It includes a set of changes and optimizations aimed at improving the efficiency of resource utilization and enhancing the processing of network requests.</p>
<p class="p_Normal">Configuring the optimized Ubuntu kernel for Kubernetes involves two stages:</p>
<ol style="list-style-type:decimal">
<li value="1" class="p_Normal"><a href="preparing-optimized-kernel.html#install-optimized-kernel" class="topiclink">Install the optimized kernel</a></li><li value="2" class="p_Normal"><a href="preparing-optimized-kernel.html#optimization-network-params" class="topiclink">Optimize network parameters</a></li></ol>
<h2 class="p_Heading2"><a id="install-optimized-kernel" class="hmanchor"></a><span class="f_Heading2">Step 1. Install the optimized kernel</span></h2>
<ol style="list-style-type:upper-roman">
<li value="1" class="p_Heading2">nstall the optimized Ubuntu kernel:</li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">sudo&nbsp;apt-get&nbsp;install&nbsp;linux-lowlatency-hwe-20.04&nbsp;-y</span></p>
<ol style="list-style-type:upper-roman">
<li value="2" class="p_Normal">After successful installation, reboot the system:</li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">sudo&nbsp;reboot</span></p>
<h2 class="p_Heading2"><a id="optimization-network-params" class="hmanchor"></a><span class="f_Heading2">Step 2. Optimize network parameters</span></h2>
<ol style="list-style-type:upper-roman">
<li value="1" class="p_Heading2">Create a <span style="font-weight: bold;">tuned-sysctl.sh</span> file and insert the following script:</li></ol>
<p class="p_CodeExample" style="white-space: normal; page-break-inside: avoid;"><span class="f_CodeExample">#!/bin/bash</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample">CONNTRACK_MAX_PER_CORE=131072</span><br />
<span class="f_CodeExample">CONNTRACK_MIN=524288</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample">CPU_NUM=`cat /proc/cpuinfo | grep -E '^processor\s+:\s+[0-9]+$' | wc -l`</span><br />
<span class="f_CodeExample">CONNTRACK_BY_CPU=$(( $CPU_NUM * $CONNTRACK_MAX_PER_CORE ))</span><br />
<span class="f_CodeExample">NF_CONNTRACK_MAX=$(( $CONNTRACK_BY_CPU &gt; $CONNTRACK_MIN ? $CONNTRACK_BY_CPU : $CONNTRACK_MIN ))</span><br />
<span class="f_CodeExample">MEM_NUM=`awk '/^MemTotal:/{print $2}' /proc/meminfo`</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample">sysctl -w net.netfilter.nf_conntrack_max=$NF_CONNTRACK_MAX # set the maximum conntrack value</span><br />
<span class="f_CodeExample">sysctl -w net.nf_conntrack_max=$NF_CONNTRACK_MAX</span><br />
<span class="f_CodeExample">echo $(( $NF_CONNTRACK_MAX / 4 )) &gt; /sys/module/nf_conntrack/parameters/hashsize # set proportional size hash table for conntrack search</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample"># General optimization</span><br />
<span class="f_CodeExample">sysctl -w vm.swappiness=0</span><br />
<span class="f_CodeExample">sysctl -w net.core.somaxconn=1000</span><br />
<span class="f_CodeExample">sysctl -w net.core.netdev_max_backlog=5000</span><br />
<span class="f_CodeExample">sysctl -w net.core.rmem_max=$MEM_NUM</span><br />
<span class="f_CodeExample">sysctl -w net.core.wmem_max=$MEM_NUM</span><br />
<span class="f_CodeExample">sysctl -w net.ipv4.tcp_wmem=&quot;4096 87380 $MEM_NUM&quot;</span><br />
<span class="f_CodeExample">sysctl -w net.ipv4.tcp_rmem=&quot;4096 87380 $MEM_NUM&quot;</span><br />
<span class="f_CodeExample">sysctl -w net.ipv4.tcp_max_syn_backlog=8096</span><br />
<span class="f_CodeExample">sysctl -w net.ipv4.tcp_no_metrics_save=1</span><br />
<span class="f_CodeExample">sysctl -w net.ipv4.tcp_slow_start_after_idle=0</span><br />
<span class="f_CodeExample">sysctl -w net.ipv4.tcp_tw_reuse=1</span><br />
<span class="f_CodeExample">sysctl -w net.ipv4.ip_local_port_range=&quot;10500 65535&quot;</span><br />
<span class="f_CodeExample">sysctl -w net.ipv4.neigh.default.gc_thresh1=16384</span><br />
<span class="f_CodeExample">sysctl -w net.ipv4.neigh.default.gc_thresh2=28672</span><br />
<span class="f_CodeExample">sysctl -w net.ipv4.neigh.default.gc_thresh3=32768</span><br />
<span class="f_CodeExample">sysctl -w net.bridge.bridge-nf-call-iptables=1 # kube-proxy requires this parameter</span><br />
<span class="f_CodeExample">sysctl -w net.bridge.bridge-nf-call-arptables=1 # kube-proxy requires this parameter</span><br />
<span class="f_CodeExample">sysctl -w net.bridge.bridge-nf-call-ip6tables=1 # kube-proxy requires this parameter</span><br />
<span class="f_CodeExample">sysctl -w vm.dirty_ratio=80</span><br />
<span class="f_CodeExample">sysctl -w vm.dirty_background_ratio=5</span><br />
<span class="f_CodeExample">sysctl -w vm.dirty_expire_centisecs=12000</span><br />
<span class="f_CodeExample">sysctl -w fs.file-max=1000000</span><br />
<span class="f_CodeExample">sysctl -w vm.min_free_kbytes=131072</span><br />
<span class="f_CodeExample">sysctl -w kernel.numa_balancing=0</span><br />
<span class="f_CodeExample">sysctl -w fs.inotify.max_user_watches=524288</span><br />
<span class="f_CodeExample">sysctl -w fs.inotify.max_user_instances=5120</span><br />
<span class="f_CodeExample">sysctl -w kernel.pid_max=2000000</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample"># kubelet parameters</span><br />
<span class="f_CodeExample">sysctl -w vm.overcommit_memory=1</span><br />
<span class="f_CodeExample">sysctl -w kernel.panic=10</span><br />
<span class="f_CodeExample">sysctl -w kernel.panic_on_oops=1</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample"># The nofile parameter sets the maximum number of opened files</span><br />
<span class="f_CodeExample">echo -e &quot;* hard nofile 4194304\n* soft nofile 4194304&quot; &gt;&gt; /etc/security/limits.conf</span></p>
<ol style="list-style-type:upper-roman">
<li value="2" class="p_CodeExample" style="page-break-inside: avoid;">Grant&nbsp;permissions&nbsp;to&nbsp;run&nbsp;the&nbsp;created&nbsp;file:</li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">sudo&nbsp;chmod&nbsp;+x&nbsp;tuned-sysctl.sh</span></p>
<ol style="list-style-type:upper-roman">
<li value="3" class="p_CodeExample" style="page-break-inside: avoid;">Run&nbsp;the&nbsp;file:</li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">sudo&nbsp;./tuned-sysctl.sh</span></p>
<ol style="list-style-type:upper-roman">
<li value="4" class="p_CodeExample" style="page-break-inside: avoid;">Open&nbsp;the&nbsp;crontab&nbsp;file&nbsp;for&nbsp;editing:</li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">sudo&nbsp;crontab&nbsp;-e</span></p>
<ol style="list-style-type:upper-roman">
<li value="5" style="line-height: 1.28; margin-top: 0; margin-right: 0; margin-bottom: 11px;">Add a command to execute the script after reboot:</li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">@reboot&nbsp;sleep&nbsp;180&nbsp;&amp;&amp;&nbsp;/path/to/tuned-sysctl.sh</span></p>

                        <div class="bottom-nav">
                            
                                <a id="prev-link" class="topic__navi_prev" href="fullchain-sertificate.html">
                                    <span class="bottom-nav__arrow bottom-nav__arrow--prev"></span> <span
                                        class="bottom-nav__link">fullchain-sertificate.html</span>
                                </a>
                            
                            
                                <a id="next-link" class="topic__navi_next" href="kubernetes-on-redos.html">
                                    <span class="bottom-nav__link">kubernetes-on-redos.html</span> <span
                                        class="bottom-nav__arrow bottom-nav__arrow--next"></span>
                                </a>
                            
                        </div>
                        <!-- добавляет на страницу строку блок Была ли статья полезной?  -->
                          <div class="feedback" id="feedback"><div class="feedback-help"><span><b>Was this helpful?</b></span><form action="" method="POST" class="feedback-form" id="feedback-form"><div class="feedback__popup feedback__popup-response" id="feedback__popup_thx" style="display: none;">Thanks for your feedback!</div><div class="feedback__popup" id="feedback__popup_why" style="display: none;"><div class="feedback__popup-header">Please specify why:</div><input type="radio" name="category" id="bad_recommendation" value="bad_recommendation"><label for="bad_recommendation">Recommendations did not help me</label><input type="radio" name="category" id="difficult_text" value="difficult_text"><label for="difficult_text">Article is hard to understand</label><input type="radio" name="category" id="no_answer" value="no_answer"><label for="no_answer">Didn`t answer my question</label><input type="radio" name="category" id="bad_header" value="bad_header"><label for="bad_header">Content does not match the topic</label><input type="radio" name="category" id="other_reason" value="other_reason"><label for="other_reason">Other</label></div><div class="feedback__popup" id="feedback__popup-other" style="display: none;"><div class="feedback__popup-header">How we can improve it?</div><textarea class="feedback__textarea" name="other" id=""></textarea><input type="submit" class="feedback__other-btn" value="Submit"></div><div class="feedback-form__btn-group"><input type="radio" name="useful" id="feedback__useful_yes" value="true"><label for="feedback__useful_yes"><img src="like.svg" class="small-img" alt="like"><spanclass="feedback-form__btn-group_yes-btn">Yes</spanclass="feedback-form__btn-group_yes-btn"></label><input type="radio" name="useful" id="feedback__useful_no" value="false"><label for="feedback__useful_no"><img src="dislike.svg" class="small-img" alt="dislike"><spanclass="feedback-form__btn-group_no-btn">No</spanclass="feedback-form__btn-group_no-btn"></label></div><select name="category"><option disabled="">Please specify why</option><option value="bad_recommendation" selected="">Recommendations did not help me</option><option value="difficult_text">Article is hard to understand</option><option value="no_answer">Didn`t answer my question</option><option value="bad_header">Content does not match the topic</option><option value="other_reason">Other</option></select><input type="submit"></form></div><div class="found_typo"><p style="margin: 0px; margin-top: 16px !important;"><span><b>Found a typo?</b></span> Select it and press <i>Ctrl+Enter</i> to send us feedback</p></div></div>
                           
                    </section>
                </div>
                <aside class="article__sidebar" style="display:none">
                    <input type="checkbox" />
                    <div class="article__arrow"></div>
                    <div class="table-of-contents elma365-right" id="toc2Content">
                        <h3 class="h3-toc">In this topic</h3>
                        <nav id="toc2"></nav>
                    </div>
                </aside>
            </div>
        </article>
    </main>               
    <footer class="footer">
        <div class="footer-container">
  <div class="footer-mobile">
    
    <ul class="footer-mobile__list"><li><a href="https://brix365.com/en/" target="_blank">BRIX</a></li><li><a href="https://tssdk.brix365.com/en/latest/" target="_blank">SDK</a></li><li><a href="https://api.brix365.com/en/" target="_blank">API</a></li></ul><ul class="footer-mobile__list"><li><a href="https://brix365.com/en/help/platform/get-trial.html">Platform</a></li><li><a href="https://brix365.com/en/help/ecm/ecm-functions.html">ECM</a></li><li><a href="https://brix365.com/en/help/service/service-functions.html">Service</a></li><li><a href="https://brix365.com/en/help/projects/projects-functions.html">Projects</a></li></ul>
    
    
  </div>
  <div class="footer-wrap">
    
      <div><span class="mobile-question-popup">Send feedback</span><form method="POST" action class="question__popup question-xs" id="question__popup"><div class="question-wrap"><span class="close"></span><span class="title">Ask a question</span><label for="help_question" style="display: none;"></label><textarea name="help_question" id="help_question"></textarea><input type="submit" value="Send"></div></form><div class="hidden fade-in question-success-xs">Sent</div></div>
    
    <div class="footer-flex-b">
      <span class="footer-copy">&copy; 2025 BRIX</span>
      <ul class="footer-list">
        
        <li class="footer-item">
            <a href="#" class="arrow-top" style="display: block;"></a>
        </li>
        
      </ul>
    </div>
  </div>
</div>
 
    </footer>
    <iframe name="hmnavigation" style="display:none!important"></iframe>
    <script src="./jquery-ui.js"></script>
    <!--script src="//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script-->
    <script src="./jquery.tocify.min.js"></script>
    <script src="./TypoReporter.min.js"></script>
    <script src="./google-search.js"></script>
    <script src="./main.js"></script>
</body>

</html>
