<!DOCTYPE html>
<html lang="ru">

<head>
    <title>Интеграция с IP-телефонией через пользовательский модуль</title>
    <meta name="generator" content="Help+Manual" />
    <meta name="keywords" content="" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Для того чтобы пользовательский модуль реализовывал подключение к телефонии, необходимо в Скриптах модуля внести следующие функции:" />
    <meta name="picture" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Cправка по Low-code платформе ELMA365" />
    <meta property="og:url" content="https://elma365.com/ru/help" />
    <meta property="og:image" content="" />
    <meta property="og:site_name" content="ELMA365" />                                                              
    <link rel="icon" href="favicon.png" type="image/png" />
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./jquery-ui.min.css" />
    <link rel="stylesheet" href="default.css" />
    <link rel="stylesheet" href="./search-yandex.css" />
    <link rel="stylesheet" href="./article.css" />
    <link rel="stylesheet" href="./glossary.css" />
    <link rel="stylesheet" href="./theme.css" />
    
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>

<body>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M6ETBEC1R9"></script><script>window.dataLayer=window.dataLayer || []; function gtag(){dataLayer.push(arguments);}gtag('js', new Date()); gtag('config', 'G-M6ETBEC1R9');</script>
    <script>!function(e,t,c,n,r,a,m){e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date;for(var s=0;s<document.scripts.length;s++)if(document.scripts[s].src===n)return;a=t.createElement(c),m=t.getElementsByTagName(c)[0],a.async=1,a.src=n,m.parentNode.insertBefore(a,m)}(window,document,"script","https://mc.yandex.ru/metrika/tag.js"),ym(83179930,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img alt=""src=https://mc.yandex.ru/watch/83179930 style=position:absolute;left:-9999px></div></noscript> 
    
    ﻿<header class="header elma-365">
  <div class="container">
    <a class="header__logo" href="https://elma365.com/ru/help">
      <img src="./logo.svg">
    </a>
 <!-- <div class="hero__search-form" id="search-panel">
   <form class="search-form" onsubmit="ym(83179930,'reachGoal','poisk')">
     <label class="search-form__label">
       <span id="reset-search" class="search__icon"></span>
       <input class="search-form__input" type="text">
     </label>
     <input class="search-form__submit" type="submit" value="Submit">
   </form>
  </div>       -->
  
     <div class="hero__search-form" id="search-panel"> <form class="search-form"> <label class="search-form__label"> <span id="reset-search" class="search__icon"></span> <input class="search-form__input" type="text"> </label> <input class="search-form__submit" type="submit" value="Submit"> </form> </div> 
  <div class="hero__search">
      <a href="#" id="search-icon" class="hero__search-icon">
        <img src="search-icon-white.svg" alt="search string">
      </a>
      <a href="#" id="side-menu-icon" class="hero__side-icon">
        <img src="side_menu.svg" alt="side menu">
      </a>
    </div>  
  <div class="header__navi">
        
        <ul class="header__list"><li><span class="solution-select"><span class="solution-select__selected"></span><svg width="7" height="4" viewBox="0 0 7 4" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L3.5 3.5L6 1" stroke="white" stroke-linecap="round" stroke-linejoin="round"/></svg><ul class="solution-select__list"><li><a class="project-link" href="https://elma365.com/ru/help/platform/get-trial.html">Платформа</a></li><li><a class="project-link" href="https://elma365.com/ru/help/ecm/ecm-functions.html">ECM</a></li><li><a class="project-link" href="https://elma365.com/ru/help/crm/crm_overview.html">CRM</a></li><li><a class="project-link" href="https://elma365.com/ru/help/service/service-functions.html">Service</a></li><li><a class="project-link" href="https://elma365.com/ru/help/projects/projects-functions.html">Проекты</a></li><li><a class="project-link" href="https://elma365.com/ru/help/business_solutions/-elma365-store.html">Бизнес-решения</a></li></ul></span></li><li><a href="https://api.elma365.com/ru/"target="_blank">API</a></li><li><a href="https://tssdk.elma365.com/"target="_blank">SDK</a></li><li><a href="https://community.elma365.com/" target="_blank">Community</a></li><li><a href="https://elma-academy.com/ru/" target="_blank">Академия</a></li><li><a href="https://elma365.com/ru/" target="_blank">Сайт ELMA365</a></li></ul> 
        
        
   </div>
  </div>

</header>



    
    <main class="main container">

        <aside class="sidebar" id="sidebar">
        <div class="sidebar__header">
                 <a class="header__logo" href="https://elma365.com/ru/help">
                    <img src="./logo-light.svg">
                 </a>
                    <span class="sidebar__close elma-365-close" id="close"></span>
            </div>
            <div class="sidebar__wrapper" id="side-menu">
                
            </div>
        </aside>

        <article class="article" id="article">
            <div class="article-inner">           
                <div class="content">
                    <header class="article__header">
                    <div class="article__bread" style="display:flex; gap:10px;">
                        <span id="subcategory" class="search-res__item-category search-res__item-category_subcategory subcategory article__badge"></span>
                        
                            <div class="topic__breadcrumbs">     
                                <p><a href="360024498352.html">Модули расширения системы</a> &gt; Примеры модулей интеграции с ELMA365 / Интеграция с IP-телефонией через пользовательский модуль</p>
                            </div>
                        
                    </div>
                        <div class="topic__title"><h1 class="p_Heading1"><span class="f_Heading1">Интеграция с IP-телефонией через пользовательский модуль</span></h1>
</div>
                    
</header>
                    <section class="article__content">
                        <div class="scroll-top-inner">
                            <a href="#h1-article" class="scroll-top"></a>
                        </div>
                        <!-- Placeholder for topic body. -->
                        <p class="p_Normal">Для того чтобы пользовательский модуль реализовывал подключение к телефонии, необходимо в <span style="font-weight: bold;">Скриптах</span> модуля внести следующие функции:</p>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">//&nbsp;Проверить&nbsp;соединение&nbsp;к&nbsp;телефонии.</span><br />
<span class="f_CodeExample">Вызывается&nbsp;по&nbsp;нажатию&nbsp;на&nbsp;кнопку&nbsp;Проверить&nbsp;соединение&nbsp;на&nbsp;странице&nbsp;модуля</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipTestConnection():&nbsp;Promise&lt;VoipTestConnectionResult&gt;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample">//&nbsp;Обработать&nbsp;запрос&nbsp;от&nbsp;провайдера&nbsp;IP-телефонии</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipParseWebhookRequest(request:&nbsp;FetchRequest):&nbsp;Promise&lt;VoipWebhookParseResult&gt;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample">//&nbsp;Получить&nbsp;список&nbsp;пользователей&nbsp;IP-телефонии.</span><br />
<span class="f_CodeExample">Используется&nbsp;для&nbsp;сопоставления&nbsp;пользователей&nbsp;по&nbsp;нажатию&nbsp;кнопки&nbsp;Настроить&nbsp;</span><br />
<span class="f_CodeExample">на&nbsp;странице&nbsp;модуля</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipGetMembers():&nbsp;Promise&lt;VoipMember[]&gt;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample">//&nbsp;Сгенерировать&nbsp;звонок</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipGenerateCall(srcPhone:&nbsp;string,&nbsp;dstPhone:&nbsp;string):&nbsp;Promise&lt;</span><span style="font-size: 11px; font-family: Consolas;">void</span><span class="f_CodeExample">&gt;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample">//&nbsp;Получить&nbsp;ссылку&nbsp;на&nbsp;запись&nbsp;звонка</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipGetCallLink(callData:&nbsp;any):&nbsp;Promise&lt;string&gt;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample">//&nbsp;Вызывать&nbsp;автоматически&nbsp;при&nbsp;изменении&nbsp;ссылки&nbsp;на&nbsp;webhook,&nbsp;например&nbsp;при&nbsp;обновлении&nbsp;токена</span><br />
<span class="f_CodeExample">//&nbsp;Эту&nbsp;функцию&nbsp;не&nbsp;обязательно&nbsp;реализовывать</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipOnWebhookUpdated(webhookUrl:&nbsp;string):&nbsp;Promise&lt;void&gt;</span></p>
<p class="p_Normal">Сохраните и опубликуйте скрипты, после чего на странице модуля появится форма <span style="font-weight: bold;">Настройки телефонии</span>.</p>
<p style="line-height: 1.28; margin: 0 0 11px 0;"><img alt="IP-Tel-integration-1" width="858" height="481" style="margin:0;width:858px;height:481px;border:none" src="ip-tel-integration-1.png"/></p>
<p class="p_Normal">Чтобы провайдер IP-телефонии мог отправлять запросы в ваш модуль ELMA365, необходимо в панели администрирования провайдера IP-телефонии заполнить адрес обратной связи (Webhook). Этот адрес указан в поле <span style="font-weight: bold;">Webhook URL</span> на странице модуля. Чтобы скопировать адрес, нажмите на значок рядом с текстовым полем. Некоторые провайдеры телефонии также требуют заполнить отдельное поле для ключа авторизации в CRM – значение этого ключа указано в поле <span style="font-weight: bold;">Токен</span> на странице модуля.</p>
<p class="p_Normal">Перед созданием пользовательского модуля интеграции убедитесь, что в каталоге <a href="https://store.elma365.ru/" target="_blank" class="weblink">ELMA365 Store</a> нет нужного вам модуля. На данный момент в каталоге доступны следующие модули:</p>
<ul style="list-style-type:disc">
<li class="p_Normal"><a href="telephony-gravitel.html" class="topiclink">«Телефония Гравител»</a>;</li><li class="p_Normal"><a href="telephony-sipnet.html" class="topiclink">«Телефония SIPNET»</a>;</li><li class="p_Normal"><a href="telephony-zadarma.html" class="topiclink">«Телефония Zadarma»</a>;</li><li class="p_Normal"><a href="mango.html" class="topiclink">«Телефония Mango»</a>;</li><li class="p_Normal"><a href="sipuni.html" class="topiclink">«Телефония Sipuni»</a>;</li><li class="p_Normal"><a href="beeline.html" class="topiclink">«Телефония Билайн»</a>;</li><li class="p_Normal"><a href="asterisk.html" class="topiclink">«Телефония Asterisk»</a>.</li></ul>
<p class="p_Normal">Обратите внимание, система телефонии <span style="font-weight: bold;">Asterisk</span> доступна только для <span style="font-weight: bold;">ELMA365 On-Premises</span>.</p>
<p class="p_Normal" style="margin: 14px 0 14px 0;">Далее приведены заготовка интеграции и пример на основе интеграции провайдера IP-телефонии <span style="font-weight: bold;">Гравител</span>.</p>
<h2 class="p_Heading2"><span class="f_Heading2">Заготовка интеграции</span></h2>
<p class="p_Normal">Чтобы создать модуль интеграции с телефонией, выполните следующие действия: </p>
<ol style="list-style-type:upper-roman">
<li value="1" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Перейдите в <span style="font-weight: bold;">Администрирование &gt; Модули</span>.</li><li value="2" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Создайте новый пользовательский модуль. Для этого:<ol style="list-style-type:decimal">
<li value="1" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Нажмите кнопку <span style="font-weight: bold;">+Модуль</span>.</li><li value="2" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">В открывшемся окне выберите опцию <span style="font-weight: bold;">Создать</span>.</li><li value="3" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Введите название и описание модуля.</li><li value="4" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Нажмите <span style="font-weight: bold;">Создать</span>.</li></ol>
<li value="3" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">В настройках модуля перейдите на вкладку <span style="font-weight: bold;">Методы API</span> и нажмите кнопку <span style="font-weight: bold;">Редактировать</span>. На открывшейся странице перейдите на вкладку <span style="font-weight: bold;">Скрипты.</span></li><li value="4" class="p_Normal">Вставьте код-заготовку для функций, необходимых для реализации интеграции с телефонией:</li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">//&nbsp;Проверить&nbsp;соединение&nbsp;к&nbsp;телефонии.</span><br />
<span class="f_CodeExample">Вызывается&nbsp;по&nbsp;нажатию&nbsp;на&nbsp;кнопку&nbsp;Проверить&nbsp;соединение&nbsp;на&nbsp;странице&nbsp;модуля</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipTestConnection():&nbsp;Promise&lt;VoipTestConnectionResult&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success:&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">false</span><span class="f_CodeExample">,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failReason:&nbsp;'Функция&nbsp;проверки&nbsp;соединения&nbsp;не&nbsp;реализована.',</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;};</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">//&nbsp;Обработать&nbsp;запрос&nbsp;от&nbsp;провайдера&nbsp;IP-телефонии</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipParseWebhookRequest(request:&nbsp;FetchRequest):&nbsp;Promise&lt;VoipWebhookParseResult&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response:&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">new</span><span class="f_CodeExample">&nbsp;HttpResponse()</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.status(400)</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.content('Hello,&nbsp;world!'),</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;};</span><br />
<span class="f_CodeExample">}&nbsp;</span><br />
<span class="f_CodeExample">//&nbsp;Получить&nbsp;список&nbsp;пользователей&nbsp;IP-телефонии.</span><br />
<span class="f_CodeExample">Используется&nbsp;для&nbsp;сопоставления&nbsp;пользователей&nbsp;по&nbsp;нажатию&nbsp;кнопки&nbsp;Настроить&nbsp;</span><br />
<span class="f_CodeExample">на&nbsp;странице&nbsp;модуля</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipGetMembers():&nbsp;Promise&lt;VoipMember[]&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error('Функция&nbsp;не&nbsp;реализована.');</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">//&nbsp;Сгенерировать&nbsp;звонок</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipGenerateCall(srcPhone:&nbsp;string,&nbsp;dstPhone:&nbsp;string):&nbsp;Promise&lt;</span><span class="f_CodeExample" style="font-weight: bold;">void</span><span class="f_CodeExample">&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error('Функция&nbsp;не&nbsp;реализована.');</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">//&nbsp;Получить&nbsp;ссылку&nbsp;на&nbsp;запись&nbsp;звонка</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipGetCallLink(callData:&nbsp;any):&nbsp;Promise&lt;string&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error('Функция&nbsp;не&nbsp;реализована.');</span><br />
<span class="f_CodeExample">}</span></p>
<ol style="list-style-type:upper-roman">
<li value="5" class="p_Normal">Нажмите кнопки <span style="font-weight: bold;">Сохранить</span> и <span style="font-weight: bold;">Опубликовать </span>в верхнем левом углу страницы.</li></ol>
<p class="p_Normal">&nbsp;</p>
<ol style="list-style-type:upper-roman">
<li value="6" class="p_Normal">Если всё было сделано верно, на странице модуля будет отображаться раздел <span style="font-weight: bold;">Настройки телефонии</span>.</li></ol>
<p style="line-height: 1.28; margin: 0 0 11px 36px;"><img alt="IP-Tel-integration-1" width="858" height="481" style="margin:0;width:858px;height:481px;border:none" src="ip-tel-integration-1.png"/></p>
<h2 class="p_Heading2"><span class="f_Heading2">Пример интеграции с Гравител</span></h2>
<ol style="list-style-type:upper-roman">
<li value="1" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Создайте заготовку модуля как описано выше.</li><li value="2" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">В настройках модуля перейдите на вкладку <span style="font-weight: bold;">Настройки </span>и создайте два строковых поля с именами <span style="font-weight: bold;">Ключ для авторизации в облачной АТС </span>и <span style="font-weight: bold;">Адрес облачной АТС</span>. В качестве названия свойства укажите <span style="font-weight: bold;">apiKey</span> и <span style="font-weight: bold;">endpoint</span> соответственно. В этих полях будут храниться настройки для подключения к Гравител со стороны модуля:</li></ol>
<p class="p_Normal" style="margin: 0 0 0 37px;"><img alt="IP-Tel-integration-3" width="864" height="478" style="margin:0;width:864px;height:478px;border:none" src="ip-tel-integration-3.png"/></p>
<ol style="list-style-type:upper-roman">
<li value="3" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Вернитесь на страницу модуля — на ней появятся добавленные в предыдущем пункте поля:</li></ol>
<p class="p_Normal" style="margin: 0 0 0 36px;"><img alt="IP-Tel-integration-4" width="858" height="478" style="margin:0;width:858px;height:478px;border:none" src="ip-tel-integration-4.png"/></p>
<ol style="list-style-type:upper-roman">
<li value="4" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Перейдите в панель управления Гравител, зайдите в раздел <span style="font-weight: bold;">Настройки</span> и выберите вкладку <span style="font-weight: bold;">Интеграция с CRM</span>. Нажмите на блок <span style="font-weight: bold;">Добавить</span> в конце списка.</li><li value="5" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">На открывшейся странице заполните поля <span style="font-weight: bold;">Имя вашей CRM</span>, <span style="font-weight: bold;">Адрес вашей CRM</span> и <span style="font-weight: bold;">Ключ для авторизации в вашей CRM</span>. Для этого скопируйте значения полей <span style="font-weight: bold;">Webhook URL</span> и <span style="font-weight: bold;">Токен</span> со страницы модуля.</li></ol>
<p class="p_Normal" style="margin: 0 0 0 36px;"><img alt="IP-Tel-integration-5" width="705" height="326" style="margin:0;width:705px;height:326px;border:none" src="ip-tel-integration-5.png"/></p>
<ol style="list-style-type:upper-roman">
<li value="6" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Скопируйте со страницы настройки интеграции в Гравител значения полей <span style="font-weight: bold;">Ключ для авторизации в Облачной АТС </span>и <span style="font-weight: bold;">Адрес Облачной АТС </span>и вставьте<span style="font-weight: bold;"> </span>в соответствующие поля на странице настройки модуля. Нажмите <span style="font-weight: bold;">Сохранить</span>. Также не забудьте сохранить интеграцию в Гравител.</li></ol>
<p class="p_Normal" style="margin: 0 0 0 35px;"><img alt="IP-Tel-integration-6" width="878" height="477" style="margin:0;width:878px;height:477px;border:none" src="ip-tel-integration-6.png"/></p>
<ol style="list-style-type:upper-roman">
<li value="7" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Перейдите в редактор скриптов (<span style="font-weight: bold;">Настройки модуля &gt; Методы API &gt; Скрипты</span>) и добавьте в начало файла следующий код:</li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">//&nbsp;Загрузить&nbsp;значение&nbsp;поля&nbsp;Ключ&nbsp;для&nbsp;авторизации&nbsp;в&nbsp;облачной&nbsp;АТС&nbsp;из&nbsp;настроек&nbsp;модуля</span><br />
<span style="font-size: 11px; font-family: Consolas;">function</span><span class="f_CodeExample">&nbsp;getApiKey()&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;apiKey&nbsp;=&nbsp;Namespace.params.data.apiKey;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">if</span><span class="f_CodeExample">&nbsp;(!apiKey)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error('invalid&nbsp;API&nbsp;key');</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;apiKey;&nbsp;&nbsp;</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">//&nbsp;Загрузить&nbsp;значение&nbsp;поля&nbsp;Адрес&nbsp;облачной&nbsp;АТС&nbsp;из&nbsp;настроек&nbsp;модуля</span><br />
<span style="font-size: 11px; font-family: Consolas;">function</span><span class="f_CodeExample">&nbsp;getEndpoint()&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;endpoint&nbsp;=&nbsp;Namespace.params.data.endpoint;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">if</span><span class="f_CodeExample">&nbsp;(!endpoint)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error('invalid&nbsp;endpoint&nbsp;URL');</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;endpoint;</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">//&nbsp;Выполнить&nbsp;запрос&nbsp;к&nbsp;Гравител</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;fetchEndpoint(command:&nbsp;string,&nbsp;body:&nbsp;Object&nbsp;=&nbsp;{}):&nbsp;Promise&lt;FetchResponse&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;fetch(getEndpoint(),&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method:&nbsp;'POST',&nbsp;&nbsp;&nbsp;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers:&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Content-Type':&nbsp;'application/json',</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body:&nbsp;JSON.stringify({</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd:&nbsp;command,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token:&nbsp;getApiKey(),</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...body,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}),</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;});</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">//&nbsp;Распарсить&nbsp;контент&nbsp;с&nbsp;типом&nbsp;application/x-www-form-urlencoded</span><br />
<span style="font-size: 11px; font-family: Consolas;">function</span><span class="f_CodeExample">&nbsp;parseUrlEncoded(body:&nbsp;string):&nbsp;Record&lt;string,&nbsp;string&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;result:&nbsp;Record&lt;string,&nbsp;string&gt;&nbsp;=&nbsp;{};</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">for</span><span class="f_CodeExample">&nbsp;(</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;pair&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">of</span><span class="f_CodeExample">&nbsp;body.split('&amp;'))&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;keyValue&nbsp;=&nbsp;pair.split('=');</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">if</span><span class="f_CodeExample">&nbsp;(keyValue.length&nbsp;===&nbsp;2)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;key&nbsp;=&nbsp;decodeURIComponent(keyValue[0]);</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;value&nbsp;=&nbsp;decodeURIComponent(keyValue[1]);</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result[key]&nbsp;=&nbsp;value;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;result;</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">//&nbsp;Сообщение&nbsp;от&nbsp;Гравител</span><br />
<span style="font-size: 11px; font-family: Consolas;">interface</span><span class="f_CodeExample">&nbsp;GravitelWebhookRequest&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;cmd:&nbsp;string;&nbsp;//&nbsp;Тип&nbsp;операции</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">type</span><span class="f_CodeExample">:&nbsp;string;&nbsp;//&nbsp;Тип&nbsp;события,&nbsp;связанного&nbsp;со&nbsp;звонком</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;phone:&nbsp;string;&nbsp;//&nbsp;Номер&nbsp;телефона&nbsp;клиента&nbsp;(в&nbsp;формате&nbsp;E.164)</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;ext?:&nbsp;string;&nbsp;//&nbsp;Внутренний&nbsp;номер&nbsp;пользователя&nbsp;облачной&nbsp;АТС,&nbsp;если&nbsp;есть</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">//&nbsp;Данные,&nbsp;передающиеся&nbsp;с&nbsp;командой&nbsp;history</span><br />
<span style="font-size: 11px; font-family: Consolas;">interface</span><span class="f_CodeExample">&nbsp;GravitelWebhookHistoryCommand&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">extends</span><span class="f_CodeExample">&nbsp;GravitelWebhookRequest&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;duration:&nbsp;string;&nbsp;//&nbsp;Общая&nbsp;длительность&nbsp;звонка&nbsp;в&nbsp;секундах</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;callid:&nbsp;string;&nbsp;//&nbsp;Уникальный&nbsp;id&nbsp;звонка</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;link?:&nbsp;string;&nbsp;//&nbsp;Ссылка&nbsp;на&nbsp;запись&nbsp;звонка,&nbsp;если&nbsp;она&nbsp;включена&nbsp;в&nbsp;Облачной&nbsp;АТС</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;status:&nbsp;string;&nbsp;//&nbsp;Статус&nbsp;входящего&nbsp;или&nbsp;исходящего&nbsp;звонка</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">//&nbsp;Данные,&nbsp;которые&nbsp;сохраняются&nbsp;с&nbsp;каждым&nbsp;звонком</span><br />
<span style="font-size: 11px; font-family: Consolas;">interface</span><span class="f_CodeExample">&nbsp;GravitelCallData&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;string;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;link:&nbsp;string;</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">//&nbsp;Сконвертировать&nbsp;статус&nbsp;звонка&nbsp;Гравител&nbsp;в&nbsp;статус&nbsp;звонка&nbsp;ELMA365</span><br />
<span style="font-size: 11px; font-family: Consolas;">function</span><span class="f_CodeExample">&nbsp;toCallDisposition(status:&nbsp;string):&nbsp;VoipCallDisposition&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">switch</span><span class="f_CodeExample">&nbsp;(status)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'Success':</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;VoipCallDisposition.Answered;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'Busy':</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;VoipCallDisposition.Busy;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'Missed':</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;VoipCallDisposition.Cancel;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'NotAvailable':</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;VoipCallDisposition.NoAnswer;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'NotAllowed':</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">default</span><span class="f_CodeExample">:</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;VoipCallDisposition.Unknown;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">}</span></p>
<ol style="list-style-type:upper-roman">
<li value="8" style="margin-top: 0; margin-right: 0; margin-bottom: 0;"><span style="font-family: 'Times New Roman',Times,Georgia,serif;">Добавьте или замените функцию </span><span class="f_CodeExample">VoipTestConnection</span><span style="font-family: 'Times New Roman',Times,Georgia,serif;">, которая используется для проверки соединения с телефонией:</span></li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">//&nbsp;Проверить&nbsp;соединение&nbsp;к&nbsp;телефонии.</span><br />
<span class="f_CodeExample">Вызывается&nbsp;по&nbsp;нажатию&nbsp;на&nbsp;кнопку&nbsp;Проверить&nbsp;соединение&nbsp;на&nbsp;странице&nbsp;модуля</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipTestConnection():&nbsp;Promise&lt;VoipTestConnectionResult&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">try</span><span class="f_CodeExample">&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Выполняем&nbsp;команду&nbsp;на&nbsp;получение&nbsp;списка&nbsp;пользователей&nbsp;телефонии</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Можно&nbsp;выбрать&nbsp;любую&nbsp;другую&nbsp;команду&nbsp;для&nbsp;тестирования</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;response&nbsp;=&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">await</span><span class="f_CodeExample">&nbsp;fetchEndpoint('accounts');</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;message&nbsp;=&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">await</span><span class="f_CodeExample">&nbsp;response.json();</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">if</span><span class="f_CodeExample">&nbsp;(response.status&nbsp;!==&nbsp;200)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error(`${response.status}&nbsp;${response.statusText}:&nbsp;${message.error}`);</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;{&nbsp;success:&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">true</span><span class="f_CodeExample">&nbsp;};</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">catch</span><span class="f_CodeExample">&nbsp;(e)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success:&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">false</span><span class="f_CodeExample">,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failReason:&nbsp;e.message,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">}</span></p>
<ol style="list-style-type:upper-roman">
<li value="9" style="margin-top: 0; margin-right: 0; margin-bottom: 0;">Сохраните и опубликуйте скрипты, после чего перейдите на страницу модуля и нажмите кнопку <span style="font-weight: bold;">Проверить соединение</span>. Появится сообщение об успешном подключении к телефонии. </li></ol>
<p class="p_Normal" style="margin: 0 0 0 36px;"><img alt="IP-Tel-integration-7" width="834" height="436" style="margin:0;width:834px;height:436px;border:none" src="ip-tel-integration-7.png"/></p>
<p class="p_Normal">Если вы видите ошибку при проверке соединения, проверьте:</p>
<ul style="list-style-type:disc">
<li style="margin-top: 0; margin-right: 0; margin-bottom: 0;">корректность заполнения настроек подключения к Гравител на странице модуля и в панели управления Гравител. Например, ошибка <span style="font-weight: bold;">Invalid token</span> означает неверно заполненное поле <span style="font-weight: bold;">Токен</span>; </li><li style="margin-top: 0; margin-right: 0; margin-bottom: 0;">успешность сохранения и публикации скриптов; </li><li style="margin-top: 0; margin-right: 0; margin-bottom: 0;">статус вашего аккаунта в Гравител.</li></ul>
<ol style="list-style-type:upper-roman" start="10">
<li value="10" class="p_Normal"> Для обработки запроса от Гравител вызывается функция <span class="f_CodeExample" style="font-size: 16px; font-family: Arial,Helvetica,sans-serif; font-weight: bold;">VoipParseWebhookRequest</span>. В ней происходит парсинг данных из тела HTTP-запроса их конвертация в формат ELMA365.</li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">//&nbsp;Обработать&nbsp;запрос&nbsp;от&nbsp;провайдера&nbsp;IP-телефонии</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipParseWebhookRequest(request:&nbsp;FetchRequest):&nbsp;Promise&lt;VoipWebhookParseResult&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">try</span><span class="f_CodeExample">&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;headers&nbsp;=&nbsp;request.headers;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;contentType&nbsp;=&nbsp;headers&nbsp;?&nbsp;headers['Content-Type']&nbsp;:&nbsp;undefined;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">&nbsp;if&nbsp;</span><span class="f_CodeExample">(contentType&nbsp;!==&nbsp;'application/x-www-form-urlencoded')&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error(`Expected&nbsp;Content-Type&nbsp;to&nbsp;be&nbsp;&quot;application/x-www-form-urlencoded&quot;&nbsp;(got:&nbsp;&quot;${contentType}&quot;`);</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">&nbsp;if</span><span class="f_CodeExample">&nbsp;(</span><span style="font-size: 11px; font-family: Consolas;">typeof</span><span class="f_CodeExample">&nbsp;request.body&nbsp;!==&nbsp;'string')&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error('Expected&nbsp;request&nbsp;body&nbsp;to&nbsp;be&nbsp;string')</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">let</span><span class="f_CodeExample">&nbsp;event:&nbsp;VoipWebhookRequest&nbsp;|&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">undefined</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">let</span><span class="f_CodeExample">&nbsp;callRecord:&nbsp;VoipCallRecord&nbsp;|&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">undefined</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">let</span><span class="f_CodeExample">&nbsp;response:&nbsp;HttpResponse&nbsp;|&nbsp;undefined;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;data&nbsp;=&nbsp;&lt;GravitelWebhookRequest&gt;&lt;unknown&gt;&nbsp;parseUrlEncoded(request.body);</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">switch</span><span class="f_CodeExample">&nbsp;(data.cmd)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'event':&nbsp;{</span><br />
<span class="f_CodeExample">//&nbsp;Облачная&nbsp;АТС&nbsp;отправляет&nbsp;в&nbsp;вашу&nbsp;CRM&nbsp;уведомления&nbsp;о&nbsp;событиях&nbsp;входящих&nbsp;звонков&nbsp;пользователям:</span><br />
<span class="f_CodeExample">появлении,&nbsp;принятии&nbsp;или&nbsp;завершении&nbsp;звонка.&nbsp;Команда&nbsp;может&nbsp;быть&nbsp;использована&nbsp;для</span><br />
<span class="f_CodeExample">отображения&nbsp;всплывающей&nbsp;карточки&nbsp;клиента&nbsp;в&nbsp;интерфейсе&nbsp;CRM</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;dstPhone&nbsp;=&nbsp;data.ext&nbsp;??&nbsp;'';</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">switch</span><span class="f_CodeExample">&nbsp;(data.</span><span style="font-size: 11px; font-family: Consolas;">type</span><span class="f_CodeExample">)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'INCOMING':&nbsp;{</span><br />
<span class="f_CodeExample">//&nbsp;Пришёл&nbsp;входящий&nbsp;звонок.&nbsp;В&nbsp;это&nbsp;время&nbsp;у&nbsp;менеджера&nbsp;должен&nbsp;начать&nbsp;звонить&nbsp;телефон</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event&nbsp;=&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event:&nbsp;VoipWebhookEvent.NotifyStart,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;direction:&nbsp;VoipCallDirection.In,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dstPhone:&nbsp;dstPhone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srcPhone:&nbsp;data.phone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disposition:&nbsp;VoipCallDisposition.Unknown,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">break</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'ACCEPTED':&nbsp;{</span><br />
<span class="f_CodeExample">//&nbsp;Звонок&nbsp;успешно&nbsp;принят,&nbsp;т.&nbsp;е.&nbsp;менеджер&nbsp;снял&nbsp;трубку.&nbsp;В&nbsp;этот&nbsp;момент&nbsp;можно&nbsp;убрать&nbsp;</span><br />
<span class="f_CodeExample">всплывающую&nbsp;карточку&nbsp;контакта&nbsp;в&nbsp;CRM</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event&nbsp;=&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event:&nbsp;VoipWebhookEvent.NotifyAnswer,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;direction:&nbsp;VoipCallDirection.In,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dstPhone:&nbsp;dstPhone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srcPhone:&nbsp;data.phone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disposition:&nbsp;VoipCallDisposition.Unknown,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">break</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'COMPLETED':&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;//&nbsp;Звонок&nbsp;успешно&nbsp;завершён,&nbsp;т.&nbsp;е.&nbsp;менеджер&nbsp;или&nbsp;клиент&nbsp;положили&nbsp;трубку&nbsp;после&nbsp;разговора</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event&nbsp;=&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event:&nbsp;VoipWebhookEvent.NotifyEnd,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;direction:&nbsp;VoipCallDirection.In,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dstPhone:&nbsp;dstPhone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srcPhone:&nbsp;data.phone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disposition:&nbsp;VoipCallDisposition.Unknown,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">break</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'CANCELLED':&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;//&nbsp;Звонок&nbsp;сброшен,&nbsp;т.е.&nbsp;клиент&nbsp;не&nbsp;дождался&nbsp;пока&nbsp;менеджер&nbsp;снимет&nbsp;трубку.</span><br />
<span class="f_CodeExample">Либо,&nbsp;если&nbsp;это&nbsp;был&nbsp;звонок&nbsp;сразу&nbsp;на&nbsp;группу&nbsp;менеджеров,&nbsp;на&nbsp;звонок&nbsp;мог&nbsp;ответить&nbsp;кто-то&nbsp;ещё</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event&nbsp;=&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event:&nbsp;VoipWebhookEvent.NotifyEnd,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;direction:&nbsp;VoipCallDirection.In,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dstPhone:&nbsp;dstPhone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srcPhone:&nbsp;data.phone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disposition:&nbsp;VoipCallDisposition.Cancel,&nbsp;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">break</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'OUTGOING':&nbsp;{</span><br />
<span class="f_CodeExample">//&nbsp;Менеджер&nbsp;совершает&nbsp;исходящий&nbsp;звонок.</span><br />
<span class="f_CodeExample">В&nbsp;это&nbsp;время&nbsp;облачная&nbsp;АТС&nbsp;пытается&nbsp;дозвониться&nbsp;до&nbsp;клиента</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event&nbsp;=&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event:&nbsp;VoipWebhookEvent.NotifyStart,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;direction:&nbsp;VoipCallDirection.Out,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dstPhone:&nbsp;dstPhone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srcPhone:&nbsp;data.phone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disposition:&nbsp;VoipCallDisposition.Unknown,&nbsp;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">break</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">default:&nbsp;throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error(`Unknown&nbsp;event&nbsp;type&nbsp;&quot;${data.</span><span style="font-size: 11px; font-family: Consolas;">type</span><span class="f_CodeExample">}&quot;`)</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">break</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">case</span><span class="f_CodeExample">&nbsp;'history':&nbsp;{</span><br />
<span class="f_CodeExample">//&nbsp;После&nbsp;успешного&nbsp;звонка&nbsp;в&nbsp;CRM&nbsp;отправляется&nbsp;запрос&nbsp;</span><br />
<span class="f_CodeExample">с&nbsp;данными&nbsp;о&nbsp;звонке&nbsp;и&nbsp;ссылкой&nbsp;на&nbsp;запись&nbsp;разговора</span><br />
<span class="f_CodeExample">//&nbsp;Команда&nbsp;может&nbsp;быть&nbsp;использована&nbsp;для&nbsp;сохранения&nbsp;</span><br />
<span class="f_CodeExample">в&nbsp;данных&nbsp;ваших&nbsp;клиентов&nbsp;истории&nbsp;и&nbsp;записей&nbsp;входящих&nbsp;и&nbsp;исходящих&nbsp;звонков</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;cmd&nbsp;=&nbsp;&lt;GravitelWebhookHistoryCommand&gt;&nbsp;data;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callRecord&nbsp;=&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srcPhone:&nbsp;cmd.phone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dstPhone:&nbsp;cmd.ext&nbsp;??&nbsp;'',</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;direction:&nbsp;cmd.type&nbsp;===&nbsp;'out'&nbsp;?&nbsp;VoipCallDirection.Out&nbsp;:&nbsp;VoipCallDirection.In,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;duration:&nbsp;parseInt(cmd.duration),</span><br />
<span class="f_CodeExample">//&nbsp;Данные&nbsp;из&nbsp;этого&nbsp;поля&nbsp;будут&nbsp;доступны&nbsp;в&nbsp;функции&nbsp;VoipGetCallLink</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call:&nbsp;&lt;GravitelCallData&gt;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;link:&nbsp;cmd.link,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;cmd.callid,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disposition:&nbsp;toCallDisposition(cmd.status),</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">break</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">return</span><span class="f_CodeExample">&nbsp;{&nbsp;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event:&nbsp;event,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callRecord:&nbsp;callRecord,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response:&nbsp;response,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">catch</span><span class="f_CodeExample">&nbsp;(e)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response:&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">new</span><span class="f_CodeExample">&nbsp;HttpResponse()</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.status(400)</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.content(JSON.stringify({</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error:&nbsp;e.message&nbsp;??&nbsp;'internal&nbsp;error',</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}))</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">}</span></p>
<ol style="list-style-type:upper-roman" start="11">
<li value="11" class="p_Normal"><span style="font-family: 'Times New Roman',Times,Georgia,serif;"> </span>Получение пользователей провайдера телефонии происходит в функции <span style="font-weight: bold;">VoipGetMembers</span>. Данные из функции используются в виджете сопоставления пользователей провайдера телефонии и пользователей ELMA365, доступном по нажатию на кнопку <span style="font-weight: bold;">Настроить</span> на странице пользовательского модуля.</li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">//&nbsp;Получить&nbsp;список&nbsp;пользователей&nbsp;от&nbsp;провайдера&nbsp;IP&nbsp;телефонии</span><br />
<span class="f_CodeExample">//&nbsp;Это&nbsp;внутренние&nbsp;пользователи&nbsp;-&nbsp;внутренние&nbsp;номера/SIPID,&nbsp;</span><br />
<span class="f_CodeExample">нужно&nbsp;для&nbsp;сопоставления&nbsp;между&nbsp;пользователями&nbsp;IP-провайдера&nbsp;и&nbsp;пользователями&nbsp;ELMA365</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipGetMembers():&nbsp;Promise&lt;VoipMember[]&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;response&nbsp;=&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">await</span><span class="f_CodeExample">&nbsp;fetchEndpoint('accounts');</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">if</span><span class="f_CodeExample">&nbsp;(response.status&nbsp;!==&nbsp;200)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error(`received&nbsp;error&nbsp;response&nbsp;${response.status}:&nbsp;${response.statusText}`);</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">&nbsp;interface&nbsp;</span><span class="f_CodeExample">GravitelVoipUser&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;string;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ext:&nbsp;string;</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;voipUsers&nbsp;=&nbsp;&lt;GravitelVoipUser[]&gt;&nbsp;(</span><span style="font-size: 11px; font-family: Consolas;">await</span><span class="f_CodeExample">&nbsp;response.json());</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;voipUsers.map(user&nbsp;=&gt;&nbsp;({</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;user.ext,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label:&nbsp;user.name,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;}));</span><br />
<span class="f_CodeExample">}</span></p>
<ol style="list-style-type:upper-roman" start="12">
<li value="12" class="p_Normal"> <span style="font-family: 'Times New Roman',Times,Georgia,serif;">Функция </span><span style="font-weight: bold;">VoipGenerateCall</span><span class="f_CodeExample"> </span><span style="font-family: 'Times New Roman',Times,Georgia,serif;">вызывается, когда совершается звонок по телефону из интерфейса ELMA365.</span></li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">//&nbsp;Сгенерировать&nbsp;звонок</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipGenerateCall(srcPhone:&nbsp;string,&nbsp;dstPhone:&nbsp;string):&nbsp;Promise&lt;</span><span style="font-size: 11px; font-family: Consolas;">void</span><span class="f_CodeExample">&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">const</span><span class="f_CodeExample">&nbsp;response&nbsp;=&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">await</span><span class="f_CodeExample">&nbsp;fetchEndpoint('makeCall',&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phone:&nbsp;dstPhone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user:&nbsp;srcPhone,</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;});</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">if</span><span class="f_CodeExample">&nbsp;(response.status&nbsp;!==&nbsp;200)&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">throw&nbsp;new</span><span class="f_CodeExample">&nbsp;Error(`received&nbsp;error&nbsp;response&nbsp;${response.status}:&nbsp;${response.statusText}`);</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="f_CodeExample">}</span></p>
<ol style="list-style-type:upper-roman" start="13">
<li value="13" class="p_Normal"><span style="font-family: 'Times New Roman',Times,Georgia,serif;"> Функция </span><span style="font-weight: bold;">VoipGetCallLink</span><span style="font-family: 'Times New Roman',Times,Georgia,serif;"> используется для получения ссылки на запись разговора. В качестве аргумента функции передаются данные поля </span><span style="font-weight: bold;">call</span><span style="font-family: 'Times New Roman',Times,Georgia,serif;"> интерфейса </span><span style="font-weight: bold;">VoipCallRecord</span><span style="font-family: 'Times New Roman',Times,Georgia,serif;"> (заполняется в </span><span style="font-weight: bold;">VoipParseWebhookRequest</span><span style="font-family: 'Times New Roman',Times,Georgia,serif;">).</span></li></ol>
<p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">//&nbsp;Получить&nbsp;ссылку&nbsp;на&nbsp;запись&nbsp;разговора</span><br />
<span style="font-size: 11px; font-family: Consolas;">async&nbsp;function</span><span class="f_CodeExample">&nbsp;VoipGetCallLink(callData:&nbsp;GravitelCallData):&nbsp;Promise&lt;string&gt;&nbsp;{</span><br />
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11px; font-family: Consolas;">return</span><span class="f_CodeExample">&nbsp;callData.link;</span><br />
<span class="f_CodeExample">}</span></p>
<ol style="list-style-type:upper-roman" start="14">
<li value="14" class="p_Normal"><span style="font-family: 'Times New Roman',Times,Georgia,serif;"> Сохраните и опубликуйте скрипты. Теперь интеграция с Гравител полностью функционирует.</span></li></ol>

                        <div class="bottom-nav">
                            
                                <a id="prev-link" class="topic__navi_prev" href="dadata_integration.html">
                                    <span class="bottom-nav__arrow bottom-nav__arrow--prev"></span> <span
                                        class="bottom-nav__link">dadata_integration.html</span>
                                </a>
                            
                            
                                <a id="next-link" class="topic__navi_next" href="360009906679.html">
                                    <span class="bottom-nav__link">360009906679.html</span> <span
                                        class="bottom-nav__arrow bottom-nav__arrow--next"></span>
                                </a>
                            
                        </div>
                        <!-- добавляет на страницу строку блок Была ли статья полезной?  -->
                          <div class="feedback-wrap"><div class="feedback" id="feedback"><span><b>Была ли статья полезной?</b></span><form action="" method="POST" class="feedback-form" id="feedback-form"><div class="feedback__popup feedback__popup-response" id="feedback__popup_thx">Спасибо за ваш отзыв!</div><div id="feedback-success-popup"><div class="wrap"><button type="button" class="feedback-popup-close">×</button><svg width="44" height="44" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_212_2187)"><path d="M22 0.6875C10.2294 0.6875 0.6875 10.2294 0.6875 22C0.6875 33.7706 10.2294 43.3125 22 43.3125C33.7706 43.3125 43.3125 33.7706 43.3125 22C43.3125 10.2294 33.7706 0.6875 22 0.6875ZM22 40.5625C11.8023 40.5625 3.4375 32.3078 3.4375 22C3.4375 11.8024 11.6922 3.4375 22 3.4375C32.1977 3.4375 40.5625 11.6922 40.5625 22C40.5625 32.1976 32.3078 40.5625 22 40.5625ZM34.1713 16.933L18.6613 32.3186C18.257 32.7197 17.604 32.7171 17.203 32.3128L9.82283 24.873C9.42176 24.4686 9.42434 23.8157 9.82867 23.4146L10.5609 22.6884C10.9652 22.2873 11.6181 22.2899 12.0192 22.6942L17.9468 28.6697L31.9926 14.7366C32.3969 14.3356 33.0498 14.3382 33.4509 14.7425L34.1772 15.4747C34.5783 15.879 34.5757 16.532 34.1713 16.933Z" fill="#27AE60"></path></g><defs><clipPath id="clip0_212_2187"><rect width="44" height="44" fill="white"></rect></clipPath></defs></svg><p>Ваш отзыв успешно отправлен!</p><span>Спасибо за обратную связь.</span></div></div><div class="feedback__popup" id="feedback__popup_why"><button type="button" class="feedback-popup-close">×</button><div class="feedback__popup-header">Уточните, почему:</div><input type="radio" name="category" id="bad_recommendation" value="bad_recommendation"><label for="bad_recommendation">Рекомендации не помогли</label><input type="radio" name="category" id="difficult_text" value="difficult_text"><label for="difficult_text">Текст трудно понять</label><input type="radio" name="category" id="no_answer" value="no_answer"><label for="no_answer">Нет ответа на мой вопрос</label><input type="radio" name="category" id="bad_header" value="bad_header"><label for="bad_header">Содержание статьи не соответствует заголовку</label><input type="radio" name="category" id="other_reason" value="other_reason"><label for="other_reason">Другая причина</label></div><div class="feedback__popup" id="feedback__popup-other"><button type="button" class="feedback-popup-close">×</button>   <div class="feedback__popup-header">Расскажите, что вам не понравилось в статье:</div><textarea class="feedback__textarea" name="other" id=""></textarea><input type="submit" class="feedback__other-btn" value="Отправить"></div><div class="feedback-form__btn-group"><input type="radio" name="useful" id="feedback__useful_yes" value="true"><label for="feedback__useful_yes"><img src="like.svg"/><span class="feedback-form__btn-group_yes-btn">Да</span></label><input type="radio" name="useful" id="feedback__useful_no" value="false"><label for="feedback__useful_no"><img src="dislike.svg"/><span class="feedback-form__btn-group_no-btn">Нет</span></label></div><select name="category"><option disabled>Выберите вариант</option><option value="bad_recommendation" selected>Рекомендации не помогли</option><option value="difficult_text">Текст трудно понять</option><option value="no_answer">Нет ответа на мой вопрос</option><option value="bad_header">Содержание статьи не соответствует заголовку</option><option value="other_reason">Другая причина</option></select><input type="submit"></form></div></div>
                           
                    </section>
                </div>
                <aside class="article__sidebar" style="display:none">
                    <input type="checkbox" />
                    <div class="article__arrow"></div>
                    <div class="table-of-contents elma365-right" id="toc2Content">
                        <h3 class="h3-toc">В этой статье</h3>
                        <nav id="toc2"></nav>
                    </div>
                </aside>
            </div>
        </article>
    </main>               
    <footer class="footer">
        <div class="footer-container">
  <div class="footer-mobile">
    
      <ul class="footer-mobile__list"><li><a href="https://api.elma365.com/ru/" target="_blank">API</a></li><li><a href="https://tssdk.elma365.com/" target="_blank">TS SDK</a></li><li><a href="https://community.elma365.com/" target="_blank">Community</a></li><li><a href="https://elma-academy.com/ru/elma365" target="_blank">Академия</a></li></ul><ul class="footer-mobile__list"><li><a href="https://elma365.com/ru/help/platform/get-trial.html">Платформа</a></li><li><a href="https://elma365.com/ru/help/ecm/ecm-functions.html">ECM</a></li><li><a href="https://elma365.com/ru/help/service/service-functions.html">Service</a></li><li><a href="https://elma365.com/ru/help/projects/projects-functions.html">Проекты</a></li></ul>
    
    
  </div>
  <div class="container">
    <div class="footer-wrap">
      
        <div><span class="mobile-question-popup">Отправить фидбэк</span><form method="POST" action class="question__popup question-xs" id="question__popup"><div class="question-wrap"><span class="close"></span><span class="title">Задать вопрос</span><label for="help_question" style="display: none;"></label><textarea name="help_question" id="help_question"></textarea><input type="submit" value="Отправить"></div></form><div class="hidden fade-in question-success-xs">Ваш фидбэк отправлен.</div></div>
      
      <div class="footer-flex-b">
        <div class="footer-top">
          <span class="footer-copy">&copy; 2025 
              ELMA365
            
            
          </span>
          
            <a href="https://navigator.sk.ru/orn/1122971" target="_blank">
              <img src="sk-resident.svg" alt="sk icon" class="footer-img" width="117" height="34">
            </a>
            
        </div>
        <div class="footer-line">
          
            <div class="footer-line-copy">
              <span class="footer-copy">&copy; 2025 
                  ELMA365
                
                
              </span>
            </div>
            
              <ul class="footer-list">
                
                  <li class="footer-item"><a href="https://elma365.com/ru/" target="_blank" class="footer-link" style="color: #0D4A75;"><img src="browse.svg" alt="browse icon" class="footer-img">elma365.com</a></li><li class="footer-item"><a href="https://www.youtube.com/user/ELMABPM" target="_blank" class="footer-link"><img src="yt.svg" alt="youtube icon" class="footer-img"></a></li><li class="footer-item"><a href="https://vk.com/elma_bpm" target="_blank" class="footer-link"><img src="vk.svg" alt="vk icon" class="footer-img"></a></li><li class="footer-item"><a href="https://t.me/elmaday" target="_blank" class="footer-link"><img src="tg.svg" alt="telegram icon" class="footer-img"></a></li><li class="footer-item"><a href="https://dzen.ru/elma" target="_blank" class="footer-link"><img src="dzen.svg" alt="dzen icon" class="footer-img"></a></li>
                
                
                  <li class="footer-item">
                    <a href="https://navigator.sk.ru/orn/1122971" target="_blank">
                      <img src="sk-resident.svg" alt="sk icon" class="footer-img" width="117" height="34">
                    </a>
                  </li>
                
                
              </ul>
        </div>
      </div>
    </div>
  </div>
  <a href="#" class="arrow-top"></a>
</div>
 
    </footer>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="jquery.min.js"></script>
    <iframe name="hmnavigation" style="display:none!important"></iframe>
    <script src="./jquery-ui.js"></script>
    <script src="./jquery-ui.min.js"></script>
    <!--script src="//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script-->
    <script src="./jquery.tocify.min.js"></script>
    <script src="./TypoReporter.min.js"></script>
    <script src="./google-search.js"></script>
    <script src="./main.js"></script>
</body>

</html>
